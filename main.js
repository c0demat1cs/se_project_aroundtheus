!function(){"use strict";class e{constructor(e,t,s,r,i,n){let{name:o,link:l,_id:a,isLiked:c}=e;this._name=o,this._link=l,this._id=a,this._isLiked=c,this._cardSelector=t,this._handleImageClick=s,this._handleDeleteCard=r,this._handleLikeClick=i,this._handleUnlikeClick=n}getId(){return this._id}getIsLiked(){return this._isLiked}_getElement(){return document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0)}getView(){return this._cardElement=this._getElement(),this._likeButton=this._cardElement.querySelector(".card__like-button"),this._deleteButton=this._cardElement.querySelector(".card__delete-button"),this._cardImageEl=this._cardElement.querySelector(".card__image"),this._cardTitleEl=this._cardElement.querySelector(".card__title"),this._cardImageEl.src=this._link,this._cardImageEl.alt=this._name,this._cardTitleEl.textContent=this._name,this._setEventListeners(),this._setLikeState(),this._cardElement}_setLikeState(){!0===this._isLiked?this._likeButton.classList.add("card__like-button_active"):this._likeButton.classList.remove("card__like-button_active")}_handleLikeIcon=()=>{this._likeButton.classList.toggle("card__like-button_active")};_setEventListeners(){this._likeButton.addEventListener("click",(()=>{!0===this._isLiked?this._handleUnlikeClick(this):this._handleLikeClick(this)})),this._deleteButton.addEventListener("click",(()=>{this._handleDeleteCard(this)})),this._cardImageEl.addEventListener("click",(()=>{this._handleImageClick({name:this._name,link:this._link})}))}deleteCard=()=>{this._cardElement.remove(),this._cardElement=null}}class t{constructor(e,t){this._formElement=t,this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._inputElements=this._formElement.querySelectorAll(this._inputSelector),this._submitButton=this._formElement.querySelector(this._submitButtonSelector)}_showInputError(e){const t=this._formElement.querySelector(`#${e.id}-error`);t.textContent=e.validationMessage,t.classList.add(this._errorClass)}_hideInputError(e){const t=this._formElement.querySelector(`#${e.id}-error`);e.classList.remove(this._inputErrorClass),t.textContent="",t.classList.remove(this._errorClass)}_checkInputValidity(e){if(!e.validity.valid)return this._showInputError(e);this._hideInputError(e)}_hasInvalidInput(){return Array.from(this._inputElements).some((e=>!e.validity.valid))}_disableButton(){this._submitButton&&(this._submitButton.classList.add(this._inactiveButtonClass),this._submitButton.disabled=!0)}_enableButton(){this._submitButton&&(this._submitButton.classList.remove(this._inactiveButtonClass),this._submitButton.disabled=!1)}_toggleButtonState(){this._hasInvalidInput()?this._disableButton():this._enableButton()}_setEventListeners(){this._inputElements.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))}))}resetValidation(){this._inputElements.forEach((e=>{this._checkInputValidity(e)})),this._toggleButtonState()}disableSubmitButton(){this._disableButton()}enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}}class s{constructor(e,t){let{items:s,renderer:r}=e;this._items=s,this._renderer=r,this._container=document.querySelector(t)}renderItems(){this._items.forEach((e=>{const t=this._renderer(e);this.addItem(t)}))}addItem(e){this._container.prepend(e)}}class r{constructor(e){let{popupSelector:t}=e;this._popupElement=document.querySelector(t),this._handleKeyDown=this._handleKeyDown.bind(this)}open(){this._popupElement.classList.add("modal_opened"),document.addEventListener("keydown",this._handleKeyDown)}close(){this._popupElement.classList.remove("modal_opened"),document.removeEventListener("keydown",this._handleKeyDown)}_handleKeyDown(e){"Escape"===e.key&&this.close()}setEventListeners(){const e=this._popupElement.querySelector(".modal__close");e&&e.addEventListener("click",(()=>this.close())),this._popupElement.addEventListener("mousedown",(e=>{e.target.classList.contains("modal_opened")&&this.close()}))}}var i=class extends r{constructor(e,t){super({popupSelector:e}),this._popupForm=this._popupElement.querySelector(".modal__form"),this._handleFormSubmit=t,this._inputFields=this._popupForm.querySelectorAll(".modal__input"),this._formSubmitHandler=this._formSubmitHandler.bind(this)}_getInputValues(){const e={};return this._inputFields.forEach((t=>{e[t.name]=t.value})),e}setEventListeners(){super.setEventListeners(),this._popupForm.addEventListener("submit",this._formSubmitHandler)}_formSubmitHandler(e){e.preventDefault(),this._handleFormSubmit(this._getInputValues())}close(){this._popupForm.reset(),super.close()}};const n={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__button",inactiveButtonClass:"modal__button_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"},o=(document.querySelector(".cards__list"),document.querySelector("#profile-edit-modal"),document.querySelector("#add-card-modal"),document.querySelector(".modal__image"),document.querySelector(".modal__popup-caption"),document.querySelector("#profile-add-button")),l=document.querySelector("#profile-edit-button"),a=document.querySelector(".profile__image"),c=document.querySelector(".profile__edit-icon"),d=(document.querySelector("#card-title-input"),document.querySelector("#card-link-input"),document.querySelector(".profile__title"),document.querySelector(".profile__description"),document.querySelector("#profile-title-input")),u=document.querySelector("#profile-description-input");document.forms["profile-form"],document.forms["card-form"];const h=new t(n,document.querySelector("#profile-form"));h.enableValidation();const _=new t(n,document.querySelector("#add-card-form"));_.enableValidation();const m=new t(n,document.querySelector("#avatar-form"));m.enableValidation();const p=new i("#add-card-modal",(e=>{var t,r;t=e.title,r=e.link,S.addNewCard({name:t,link:r}).then((e=>{!function(e){const t=y(e);new s({},"#cards__list").addItem(t)}(e),_.disableSubmitButton(),p.close()})).catch((e=>{console.error(e)}))}));p.setEventListeners();const E=new i("#profile-edit-modal",(function(e){let{title:t,description:s}=e;S.editProfileInfo({name:t,about:s}).then((e=>{k.setUserInfo(e.name,e.about),h.disableSubmitButton(),E.close()})).catch((e=>{console.error(e)}))}));E.setEventListeners();const f=new class extends r{constructor(e){super({popupSelector:e}),this._popupCaption=this._popupElement.querySelector(".modal__popup-caption"),this._imageElement=this._popupElement.querySelector(".modal__image")}open(e){let{link:t,name:s}=e;this._popupCaption.textContent=s,this._imageElement.src=t,this._imageElement.alt=`Image of ${s}`,super.open()}}("#image-modal");f.setEventListeners();const v=new class extends r{constructor(e){super({popupSelector:e})}setEventListeners(){super.setEventListeners(),this._popupElement.addEventListener("submit",(e=>{e.preventDefault(),this._handleSubmit()}))}setSubmitCallback(e){this._handleSubmit=e}}("#delete-card-modal",C);v.setEventListeners();const b=new i("#avatar-modal",(function(){const e=document.querySelector("#avatar-link-input").value;S.updateAvatar({avatar:e}).then((e=>{a.src=e.avatar,m.disableSubmitButton(),b.close()})).catch((e=>{console.error(e)}))}));b.setEventListeners();const k=new class{constructor(e,t,s){this._profileTitleElement=document.querySelector(e),this._profileDescriptionElement=document.querySelector(t),this._profileAvatarElement=document.querySelector(s)}getUserInfo(){return{title:this._profileTitleElement.textContent,description:this._profileDescriptionElement.textContent}}setUserInfo(e,t){this._profileTitleElement.textContent=e,this._profileDescriptionElement.textContent=t}setAvatar(e){this._profileAvatarElement.src=e}}(".profile__title",".profile__description",".profile__image"),S=new class{constructor(e){this.baseUrl=e.baseUrl,this.headers=e.headers}getUserInfo(){return fetch(`${this.baseUrl}/users/me`,{headers:this.headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}getInitialCards(){return fetch(`${this.baseUrl}/cards`,{headers:this.headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}editProfileInfo(e){let{name:t,about:s}=e;return fetch(`${this.baseUrl}/users/me`,{method:"PATCH",headers:this.headers,body:JSON.stringify({name:t,about:s})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}addNewCard(e){let{name:t,link:s}=e;return fetch(`${this.baseUrl}/cards`,{method:"POST",headers:this.headers,body:JSON.stringify({name:t,link:s})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}deleteCard(e){return fetch(`${this.baseUrl}/cards/${e}`,{method:"DELETE",headers:this.headers}).then((e=>e.ok?Promise.resolve("Card deleted"):Promise.reject(`Error: ${e.status}`)))}likeCard(e){return fetch(`${this.baseUrl}/cards/${e}/likes`,{method:"PUT",headers:this.headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}removeLike(e){return fetch(`${this.baseUrl}/cards/${e}/likes`,{method:"DELETE",headers:this.headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}updateAvatar(e){let{avatar:t}=e;return fetch(`${this.baseUrl}/users/me/avatar`,{method:"PATCH",headers:this.headers,body:JSON.stringify({avatar:t})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"d918969b-47fa-4f72-8138-61be6ab55840","Content-Type":"application/json"}});function y(t){return new e(t,"#card-template",L,C,g,I).getView()}function L(e){let{name:t,link:s}=e;f.open({link:s,name:t})}function C(e){v.open(),v.setSubmitCallback((()=>{S.deleteCard(e.getId()).then((()=>{e.deleteCard(),v.close()})).catch((e=>{console.error(e)}))}))}function g(e){S.likeCard(e._id).then((t=>{e._handleLikeIcon(),e._isLiked=!0,console.log("Card liked:",t)})).catch((e=>{console.error(e)}))}function I(e){S.removeLike(e._id).then((t=>{e._handleLikeIcon(),e._isLiked=!1,console.log("Card disliked:",t)})).catch((e=>{console.log(e)}))}S.getInitialCards().then((e=>{new s({items:e.reverse(),renderer:y},"#cards__list").renderItems(e)})).catch((e=>{console.error(e)})),S.getUserInfo().then((e=>{k.setUserInfo(e.name,e.about),k.setAvatar(e.avatar)})).catch((e=>{console.error(e)})),l.addEventListener("click",(()=>{const e=k.getUserInfo();d.value=e.title,u.value=e.description,h.resetValidation(),E.open()})),o.addEventListener("click",(()=>{p.open()})),c.addEventListener("click",(()=>{b.open()}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QyxJQUNMd0QsRUFBSzFKLGtCQUNMMEosRUFBS3BMLFVBQVcsRUFDaEJtSSxRQUFRa0QsSUFBSSxpQkFBa0J6RCxFQUFLLElBRXBDSyxPQUFPQyxJQUNOQyxRQUFRa0QsSUFBSW5ELEVBQUksR0FFdEIsQ0F4SUFULEVBQ0dnRCxrQkFDQTlDLE1BQU0yRCxJQUVTLElBQUloSCxFQUNoQixDQUNFRSxNQUFPOEcsRUFBT0MsVUFDZDlHLFNBQVVzRCxHQUVaLGdCQUVNbEQsWUFBWXlHLEVBQU8sSUFFNUJyRCxPQUFPQyxJQUNOQyxRQUFRQyxNQUFNRixFQUFJLElBSXRCVCxFQUNHb0MsY0FDQWxDLE1BQU0yRCxJQUdMNUMsRUFBU0MsWUFBWTJDLEVBQU83TCxLQUFNNkwsRUFBTzdDLE9BQ3pDQyxFQUFTb0IsVUFBVXdCLEVBQU9qQyxPQUFPLElBRWxDcEIsT0FBT0MsSUFDTkMsUUFBUUMsTUFBTUYsRUFBSSxJQWtJdEJ0QixFQUFrQmhGLGlCQUFpQixTQUFTLEtBQzFDLE1BQU00SixFQUFXOUMsRUFBU21CLGNBQzFCOUMsRUFBa0JQLE1BQVFnRixFQUFTaEUsTUFDbkNSLEVBQXdCUixNQUFRZ0YsRUFBU2pELFlBQ3pDckIsRUFBa0JqRCxrQkFDbEJvRSxFQUFpQjlDLE1BQU0sSUFJekJvQixFQUFpQi9FLGlCQUFpQixTQUFTLEtBQ3pDeUYsRUFBYTlCLE1BQU0sSUFJckJ1QixFQUFvQmxGLGlCQUFpQixTQUFTLEtBQzVDd0gsRUFBa0I3RCxNQUFNLEciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9DYXJkLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvU2VjdGlvbi5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Qb3B1cC5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy91dGlscy9jb25zdGFudHMuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL3BhZ2VzL2luZGV4LmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aENvbmZpcm1hdGlvbi5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Vc2VySW5mby5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9BcGkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2FyZCB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHsgbmFtZSwgbGluaywgX2lkLCBpc0xpa2VkIH0sXG4gICAgY2FyZFNlbGVjdG9yLFxuICAgIGhhbmRsZUltYWdlQ2xpY2ssXG4gICAgX2hhbmRsZURlbGV0ZUNhcmQsXG4gICAgaGFuZGxlTGlrZUNsaWNrLFxuICAgIGhhbmRsZVVubGlrZUNsaWNrXG4gICkge1xuICAgIHRoaXMuX25hbWUgPSBuYW1lO1xuICAgIHRoaXMuX2xpbmsgPSBsaW5rO1xuICAgIHRoaXMuX2lkID0gX2lkO1xuICAgIHRoaXMuX2lzTGlrZWQgPSBpc0xpa2VkO1xuICAgIHRoaXMuX2NhcmRTZWxlY3RvciA9IGNhcmRTZWxlY3RvcjtcbiAgICB0aGlzLl9oYW5kbGVJbWFnZUNsaWNrID0gaGFuZGxlSW1hZ2VDbGljaztcbiAgICB0aGlzLl9oYW5kbGVEZWxldGVDYXJkID0gX2hhbmRsZURlbGV0ZUNhcmQ7XG4gICAgdGhpcy5faGFuZGxlTGlrZUNsaWNrID0gaGFuZGxlTGlrZUNsaWNrO1xuICAgIHRoaXMuX2hhbmRsZVVubGlrZUNsaWNrID0gaGFuZGxlVW5saWtlQ2xpY2s7XG4gIH1cblxuICBnZXRJZCgpIHtcbiAgICByZXR1cm4gdGhpcy5faWQ7XG4gIH1cblxuICAvLyBnZXQgdGhlIGxpa2Ugc3RhdHVzXG4gIGdldElzTGlrZWQoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2lzTGlrZWQ7XG4gIH1cblxuICAvLyAgTUVUSE9EU1xuICAvL2Fic3RyYWN0aW9uIHRvIGdldCB0aGUgY2FyZCBlbGVtZW50XG4gIF9nZXRFbGVtZW50KCkge1xuICAgIHJldHVybiBkb2N1bWVudFxuICAgICAgLnF1ZXJ5U2VsZWN0b3IodGhpcy5fY2FyZFNlbGVjdG9yKVxuICAgICAgLmNvbnRlbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpXG4gICAgICAuY2xvbmVOb2RlKHRydWUpO1xuICB9XG5cbiAgLy8gZ2V0VmlldyBkZWZpbmVzIHRoZSBjYXJkIGVsZW1lbnRcbiAgZ2V0VmlldygpIHtcbiAgICB0aGlzLl9jYXJkRWxlbWVudCA9IHRoaXMuX2dldEVsZW1lbnQoKTtcbiAgICB0aGlzLl9saWtlQnV0dG9uID0gdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19saWtlLWJ1dHRvblwiKTtcbiAgICB0aGlzLl9kZWxldGVCdXR0b24gPSB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgXCIuY2FyZF9fZGVsZXRlLWJ1dHRvblwiXG4gICAgKTtcbiAgICB0aGlzLl9jYXJkSW1hZ2VFbCA9IHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9faW1hZ2VcIik7XG4gICAgdGhpcy5fY2FyZFRpdGxlRWwgPSB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3RpdGxlXCIpO1xuICAgIHRoaXMuX2NhcmRJbWFnZUVsLnNyYyA9IHRoaXMuX2xpbms7XG4gICAgdGhpcy5fY2FyZEltYWdlRWwuYWx0ID0gdGhpcy5fbmFtZTtcbiAgICB0aGlzLl9jYXJkVGl0bGVFbC50ZXh0Q29udGVudCA9IHRoaXMuX25hbWU7XG5cbiAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xuICAgIHRoaXMuX3NldExpa2VTdGF0ZSgpO1xuICAgIC8vIHJldHVybiB0aGUgY2FyZFxuICAgIHJldHVybiB0aGlzLl9jYXJkRWxlbWVudDtcbiAgfVxuXG4gIF9zZXRMaWtlU3RhdGUoKSB7XG4gICAgLy8gaWYgdGhlIGJ1dHRvbiBpcyBsaWtlZFxuICAgIC8vIHNob3cgdGhlIHN0YXRlIG9mIHRoZSBidXR0b25cbiAgICBpZiAodGhpcy5faXNMaWtlZCA9PT0gdHJ1ZSkge1xuICAgICAgdGhpcy5fbGlrZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwiY2FyZF9fbGlrZS1idXR0b25fYWN0aXZlXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9saWtlQnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoXCJjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmVcIik7XG4gICAgfVxuICB9XG5cbiAgX2hhbmRsZUxpa2VJY29uID0gKCkgPT4ge1xuICAgIHRoaXMuX2xpa2VCdXR0b24uY2xhc3NMaXN0LnRvZ2dsZShcImNhcmRfX2xpa2UtYnV0dG9uX2FjdGl2ZVwiKTtcbiAgfTtcblxuICAvLyBMSVNURU5FUlNcbiAgLy8gZmV0Y2ggZWFjaCBlbGVtZW50ICwgYWRkIGxpc3RlbmVyXG4gIF9zZXRFdmVudExpc3RlbmVycygpIHtcbiAgICB0aGlzLl9saWtlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICBpZiAodGhpcy5faXNMaWtlZCA9PT0gdHJ1ZSkge1xuICAgICAgICB0aGlzLl9oYW5kbGVVbmxpa2VDbGljayh0aGlzKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX2hhbmRsZUxpa2VDbGljayh0aGlzKTtcbiAgICAgIH1cbiAgICAgIC8vdGhpcy5faGFuZGxlTGlrZUljb24oKTtcbiAgICB9KTtcbiAgICB0aGlzLl9kZWxldGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHRoaXMuX2hhbmRsZURlbGV0ZUNhcmQodGhpcyk7XG4gICAgfSk7XG5cbiAgICAvLyBIYW5kbGUgaW1hZ2UgY2xpY2tcbiAgICB0aGlzLl9jYXJkSW1hZ2VFbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5faGFuZGxlSW1hZ2VDbGljayh7IG5hbWU6IHRoaXMuX25hbWUsIGxpbms6IHRoaXMuX2xpbmsgfSk7XG4gICAgfSk7XG4gIH1cblxuICAvLyBIQU5ETEVSUztcblxuICBkZWxldGVDYXJkID0gKCkgPT4ge1xuICAgIHRoaXMuX2NhcmRFbGVtZW50LnJlbW92ZSgpO1xuICAgIHRoaXMuX2NhcmRFbGVtZW50ID0gbnVsbDtcbiAgfTtcbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEZvcm1WYWxpZGF0b3Ige1xuICBjb25zdHJ1Y3RvcihzZXR0aW5ncywgZm9ybUVsZW1lbnQpIHtcbiAgICB0aGlzLl9mb3JtRWxlbWVudCA9IGZvcm1FbGVtZW50O1xuICAgIHRoaXMuX2lucHV0U2VsZWN0b3IgPSBzZXR0aW5ncy5pbnB1dFNlbGVjdG9yO1xuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvblNlbGVjdG9yID0gc2V0dGluZ3Muc3VibWl0QnV0dG9uU2VsZWN0b3I7XG4gICAgdGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyA9IHNldHRpbmdzLmluYWN0aXZlQnV0dG9uQ2xhc3M7XG4gICAgdGhpcy5faW5wdXRFcnJvckNsYXNzID0gc2V0dGluZ3MuaW5wdXRFcnJvckNsYXNzO1xuICAgIHRoaXMuX2Vycm9yQ2xhc3MgPSBzZXR0aW5ncy5lcnJvckNsYXNzO1xuXG4gICAgLy8gU2F2ZSBlbGVtZW50cyBpbiB0aGUgY2xhc3MgaW5zdGFuY2VcbiAgICB0aGlzLl9pbnB1dEVsZW1lbnRzID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbChcbiAgICAgIHRoaXMuX2lucHV0U2VsZWN0b3JcbiAgICApO1xuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbiA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICB0aGlzLl9zdWJtaXRCdXR0b25TZWxlY3RvclxuICAgICk7XG4gIH1cblxuICBfc2hvd0lucHV0RXJyb3IoaW5wdXRFbGVtZW50KSB7XG4gICAgY29uc3QgZXJyb3JNZXNzYWdlRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBgIyR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmBcbiAgICApO1xuICAgIGVycm9yTWVzc2FnZUVsZW1lbnQudGV4dENvbnRlbnQgPSBpbnB1dEVsZW1lbnQudmFsaWRhdGlvbk1lc3NhZ2U7XG4gICAgZXJyb3JNZXNzYWdlRWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX2Vycm9yQ2xhc3MpO1xuICB9XG5cbiAgX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCkge1xuICAgIGNvbnN0IGVycm9yTWVzc2FnZUVsZW1lbnQgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgYCMke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgXG4gICAgKTtcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9pbnB1dEVycm9yQ2xhc3MpO1xuICAgIGVycm9yTWVzc2FnZUVsZW1lbnQudGV4dENvbnRlbnQgPSBcIlwiO1xuICAgIGVycm9yTWVzc2FnZUVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9lcnJvckNsYXNzKTtcbiAgfVxuXG4gIF9jaGVja0lucHV0VmFsaWRpdHkoaW5wdXRFbGVtZW50KSB7XG4gICAgaWYgKCFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpIHtcbiAgICAgIHJldHVybiB0aGlzLl9zaG93SW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpO1xuICAgIH1cbiAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpO1xuICB9XG5cbiAgX2hhc0ludmFsaWRJbnB1dCgpIHtcbiAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLl9pbnB1dEVsZW1lbnRzKS5zb21lKFxuICAgICAgKGlucHV0RWxlbWVudCkgPT4gIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZFxuICAgICk7XG4gIH1cblxuICBfZGlzYWJsZUJ1dHRvbigpIHtcbiAgICBpZiAodGhpcy5fc3VibWl0QnV0dG9uKSB7XG4gICAgICB0aGlzLl9zdWJtaXRCdXR0b24uY2xhc3NMaXN0LmFkZCh0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgX2VuYWJsZUJ1dHRvbigpIHtcbiAgICBpZiAodGhpcy5fc3VibWl0QnV0dG9uKSB7XG4gICAgICB0aGlzLl9zdWJtaXRCdXR0b24uY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIF90b2dnbGVCdXR0b25TdGF0ZSgpIHtcbiAgICBpZiAodGhpcy5faGFzSW52YWxpZElucHV0KCkpIHtcbiAgICAgIHRoaXMuX2Rpc2FibGVCdXR0b24oKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fZW5hYmxlQnV0dG9uKCk7XG4gICAgfVxuICB9XG5cbiAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHRoaXMuX2lucHV0RWxlbWVudHMuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgICBpbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcbiAgICAgICAgdGhpcy5fY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWxlbWVudCk7XG4gICAgICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIHJlc2V0VmFsaWRhdGlvbigpIHtcbiAgICB0aGlzLl9pbnB1dEVsZW1lbnRzLmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xuICAgICAgdGhpcy5fY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWxlbWVudCk7XG4gICAgfSk7XG4gICAgdGhpcy5fdG9nZ2xlQnV0dG9uU3RhdGUoKTtcbiAgfVxuXG4gIGRpc2FibGVTdWJtaXRCdXR0b24oKSB7XG4gICAgdGhpcy5fZGlzYWJsZUJ1dHRvbigpO1xuICB9XG5cbiAgZW5hYmxlVmFsaWRhdGlvbigpIHtcbiAgICB0aGlzLl9mb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH0pO1xuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XG4gIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlY3Rpb24ge1xuICBjb25zdHJ1Y3Rvcih7IGl0ZW1zLCByZW5kZXJlciB9LCBjb250YWluZXJTZWxlY3Rvcikge1xuICAgIHRoaXMuX2l0ZW1zID0gaXRlbXM7XG4gICAgdGhpcy5fcmVuZGVyZXIgPSByZW5kZXJlcjtcbiAgICB0aGlzLl9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lclNlbGVjdG9yKTtcbiAgfVxuXG4gIHJlbmRlckl0ZW1zKCkge1xuICAgIHRoaXMuX2l0ZW1zLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgIGNvbnN0IGVsZW1lbnQgPSB0aGlzLl9yZW5kZXJlcihpdGVtKTtcbiAgICAgIHRoaXMuYWRkSXRlbShlbGVtZW50KTtcbiAgICB9KTtcbiAgfVxuXG4gIGFkZEl0ZW0oZWxlbWVudCkge1xuICAgIHRoaXMuX2NvbnRhaW5lci5wcmVwZW5kKGVsZW1lbnQpO1xuICB9XG59XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cCB7XG4gIGNvbnN0cnVjdG9yKHsgcG9wdXBTZWxlY3RvciB9KSB7XG4gICAgdGhpcy5fcG9wdXBFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihwb3B1cFNlbGVjdG9yKTtcbiAgICB0aGlzLl9oYW5kbGVLZXlEb3duID0gdGhpcy5faGFuZGxlS2V5RG93bi5iaW5kKHRoaXMpO1xuICB9XG5cbiAgLy8gb3BlbnMgcG9wdXBcbiAgb3BlbigpIHtcbiAgICB0aGlzLl9wb3B1cEVsZW1lbnQuY2xhc3NMaXN0LmFkZChcIm1vZGFsX29wZW5lZFwiKTtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9oYW5kbGVLZXlEb3duKTtcbiAgfVxuXG4gIC8vIGNsb3NlcyBwb3B1cFxuICBjbG9zZSgpIHtcbiAgICB0aGlzLl9wb3B1cEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX29wZW5lZFwiKTtcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9oYW5kbGVLZXlEb3duKTtcbiAgfVxuXG4gIC8vIGxpc3RlbnMgZm9yIGVzYyBidXR0b25cbiAgX2hhbmRsZUtleURvd24oZXZ0KSB7XG4gICAgaWYgKGV2dC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9XG4gIH1cblxuICAvLyBzZXRzIGV2ZW50IGxpc3RlbmVyc1xuICBzZXRFdmVudExpc3RlbmVycygpIHtcbiAgICBjb25zdCBjbG9zZUJ1dHRvbiA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZVwiKTtcbiAgICBpZiAoY2xvc2VCdXR0b24pIHtcbiAgICAgIGNsb3NlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB0aGlzLmNsb3NlKCkpO1xuICAgIH1cbiAgICB0aGlzLl9wb3B1cEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCAoZXZ0KSA9PiB7XG4gICAgICBpZiAoZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJtb2RhbF9vcGVuZWRcIikpIHtcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG59XG4iLCIvLyB0aGlzIGNsYXNzIGlzIGEgY2hpbGQgY2xhc3Mgb2YgdGhlIFBvcHVwIGNsYXNzXG4vLyBpdCBkZWFscyBleGNsdXNpdmVseSB3aXRoIGZvcm1zXG5pbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcblxuY2xhc3MgUG9wdXBXaXRoRm9ybSBleHRlbmRzIFBvcHVwIHtcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3RvciwgaGFuZGxlRm9ybVN1Ym1pdCkge1xuICAgIHN1cGVyKHsgcG9wdXBTZWxlY3RvciB9KTsgLy8gY2FsbCB0aGUgY29uc3RydWN0b3Igb2YgdGhlIHBhcmVudCBjbGFzcyBQb3B1cFxuICAgIHRoaXMuX3BvcHVwRm9ybSA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpOyAvLyBhY2Nlc3MgdGhlIGZvcm0gZWxlbWVudCBpbnNpZGUgdGhlIHBvcHVwXG4gICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCA9IGhhbmRsZUZvcm1TdWJtaXQ7IC8vIHNhdmUgdGhlIGhhbmRsZUZvcm1TdWJtaXQgZnVuY3Rpb24gZm9yIGxhdGVyIHVzZVxuICAgIHRoaXMuX2lucHV0RmllbGRzID0gdGhpcy5fcG9wdXBGb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoXCIubW9kYWxfX2lucHV0XCIpO1xuICAgIHRoaXMuX2Zvcm1TdWJtaXRIYW5kbGVyID0gdGhpcy5fZm9ybVN1Ym1pdEhhbmRsZXIuYmluZCh0aGlzKTsgLy8gYmluZHMgZXZ0IGxzdG5yIHRvIHRoaXNcbiAgfVxuXG4gIC8vIGNvbGxlY3RzIGRhdGEgZnJvbSBhbGwgdGhlIGlucHV0IGZpZWxkcyBhbmQgcmV0dXJucyBpdCBhcyBhbiBvYmplY3RcbiAgX2dldElucHV0VmFsdWVzKCkge1xuICAgIGNvbnN0IGlucHV0VmFsdWVzID0ge307XG4gICAgdGhpcy5faW5wdXRGaWVsZHMuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICAgIGlucHV0VmFsdWVzW2lucHV0Lm5hbWVdID0gaW5wdXQudmFsdWU7XG4gICAgfSk7XG4gICAgcmV0dXJuIGlucHV0VmFsdWVzO1xuICB9XG5cbiAgLy8gb3ZlcnJpZGUgdGhlIHBhcmVudCBtZXRob2RcbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgICAvLyBsaXN0ZW5zIGZvciBmb3JtIHN1Ym1pc3Npb25cbiAgICB0aGlzLl9wb3B1cEZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCB0aGlzLl9mb3JtU3VibWl0SGFuZGxlcik7XG4gIH1cblxuICAvLyBoYW5kbGUgZm9ybSBzdWJtaXRcbiAgX2Zvcm1TdWJtaXRIYW5kbGVyKGV2dCkge1xuICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHRoaXMuX2hhbmRsZUZvcm1TdWJtaXQodGhpcy5fZ2V0SW5wdXRWYWx1ZXMoKSk7XG4gIH1cblxuICAvLyBjbG9zZXMgYW5kIHJlc2V0cyB0aGUgZm9ybVxuICBjbG9zZSgpIHtcbiAgICB0aGlzLl9wb3B1cEZvcm0ucmVzZXQoKTtcbiAgICBzdXBlci5jbG9zZSgpO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFBvcHVwV2l0aEZvcm07XG4iLCJleHBvcnQgY29uc3Qgc2V0dGluZ3MgPSB7XG4gIGZvcm1TZWxlY3RvcjogXCIubW9kYWxfX2Zvcm1cIixcbiAgaW5wdXRTZWxlY3RvcjogXCIubW9kYWxfX2lucHV0XCIsXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fYnV0dG9uXCIsXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwibW9kYWxfX2J1dHRvbl9kaXNhYmxlZFwiLFxuICBpbnB1dEVycm9yQ2xhc3M6IFwibW9kYWxfX2lucHV0X3R5cGVfZXJyb3JcIixcbiAgZXJyb3JDbGFzczogXCJtb2RhbF9fZXJyb3JfdmlzaWJsZVwiLFxufTtcblxuLy8gV1JBUFBFUlNcbmV4cG9ydCBjb25zdCBwbGFjZXNXcmFwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkc19fbGlzdFwiKTtcbmV4cG9ydCBjb25zdCBwcm9maWxlRWRpdE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlLWVkaXQtbW9kYWxcIik7XG5leHBvcnQgY29uc3QgYWRkQ2FyZE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNhZGQtY2FyZC1tb2RhbFwiKTtcbmV4cG9ydCBjb25zdCBtb2RhbEltYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9faW1hZ2VcIik7XG5leHBvcnQgY29uc3QgaW1hZ2VDYXB0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fcG9wdXAtY2FwdGlvblwiKTtcblxuLy8gQlVUVE9OUyBBTkQgT1RIRVIgRE9NIEVMRU1FTlRTXG5leHBvcnQgY29uc3QgcHJvZmlsZUFkZEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS1hZGQtYnV0dG9uXCIpO1xuZXhwb3J0IGNvbnN0IHByb2ZpbGVFZGl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlLWVkaXQtYnV0dG9uXCIpO1xuZXhwb3J0IGNvbnN0IHByb2ZpbGVBdmF0YXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2ltYWdlXCIpO1xuZXhwb3J0IGNvbnN0IHByb2ZpbGVBdmF0YXJCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICBcIi5wcm9maWxlX19lZGl0LWljb25cIlxuKTtcblxuLy8gRk9STSBEQVRBXG5leHBvcnQgY29uc3QgY2FyZFRpdGxlSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtdGl0bGUtaW5wdXRcIik7XG5leHBvcnQgY29uc3QgY2FyZExpbmtJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC1saW5rLWlucHV0XCIpO1xuZXhwb3J0IGNvbnN0IHByb2ZpbGVUaXRsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fdGl0bGVcIik7XG5leHBvcnQgY29uc3QgcHJvZmlsZURlc2NyaXB0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgXCIucHJvZmlsZV9fZGVzY3JpcHRpb25cIlxuKTtcbmV4cG9ydCBjb25zdCBwcm9maWxlVGl0bGVJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS10aXRsZS1pbnB1dFwiKTtcbmV4cG9ydCBjb25zdCBwcm9maWxlRGVzY3JpcHRpb25JbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gIFwiI3Byb2ZpbGUtZGVzY3JpcHRpb24taW5wdXRcIlxuKTtcbmV4cG9ydCBjb25zdCBwcm9maWxlRm9ybSA9IGRvY3VtZW50LmZvcm1zW1wicHJvZmlsZS1mb3JtXCJdO1xuZXhwb3J0IGNvbnN0IGNhcmRGb3JtID0gZG9jdW1lbnQuZm9ybXNbXCJjYXJkLWZvcm1cIl07XG4iLCJpbXBvcnQgXCIuL2luZGV4LmNzc1wiO1xuaW1wb3J0IENhcmQgZnJvbSBcIi4uL2NvbXBvbmVudHMvQ2FyZC5qc1wiO1xuaW1wb3J0IEZvcm1WYWxpZGF0b3IgZnJvbSBcIi4uL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qc1wiO1xuaW1wb3J0IHsgVXNlckluZm8gfSBmcm9tIFwiLi4vY29tcG9uZW50cy9Vc2VySW5mby5qc1wiO1xuaW1wb3J0IFNlY3Rpb24gZnJvbSBcIi4uL2NvbXBvbmVudHMvU2VjdGlvbi5qc1wiO1xuaW1wb3J0IFBvcHVwV2l0aEZvcm0gZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qc1wiO1xuaW1wb3J0IFBvcHVwV2l0aEltYWdlIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzXCI7XG5pbXBvcnQgUG9wdXBXaXRoQ29uZmlybWF0aW9uIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aENvbmZpcm1hdGlvbi5qc1wiO1xuaW1wb3J0IHtcbiAgc2V0dGluZ3MsXG4gIHByb2ZpbGVBZGRCdXR0b24sXG4gIHByb2ZpbGVFZGl0QnV0dG9uLFxuICBwcm9maWxlQXZhdGFyQnV0dG9uLFxuICBwcm9maWxlVGl0bGVJbnB1dCxcbiAgcHJvZmlsZUF2YXRhcixcbiAgcHJvZmlsZURlc2NyaXB0aW9uSW5wdXQsXG59IGZyb20gXCIuLi91dGlscy9jb25zdGFudHMuanNcIjtcbmltcG9ydCBBcGkgZnJvbSBcIi4uL2NvbXBvbmVudHMvQXBpLmpzXCI7XG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cXFxuXG4vLyA9PT09PT09PT0gIEZPUk0gVkFMSURBVE9SUyAgPT09PT09PT09IC8vXG5cbi8vIE5ldyBFZGl0IEZvcm0gVmFsaWRhdG9yIGluc3RhbmNlXG5jb25zdCBlZGl0Rm9ybVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKFxuICBzZXR0aW5ncyxcbiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlLWZvcm1cIilcbik7XG5lZGl0Rm9ybVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7IC8vIGNhbGwgZW5hYmxlIHZhbGlkYXRpb25cblxuLy8gTmV3IENhcmQgZm9ybSB2YWxpZGF0b3IgaW5zdGFuY2VcbmNvbnN0IGNhcmRGb3JtVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoXG4gIHNldHRpbmdzLFxuICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2FkZC1jYXJkLWZvcm1cIilcbik7XG5jYXJkRm9ybVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7IC8vIGNhbGwgZW5hYmxlIHZhbGlkYXRpb25cblxuLy8gbmV3IGF2YXRhciBmb3JtIHZhbGlkYXRvciBpbnN0YW5jZVxuY29uc3QgYXZhdGFyRm9ybVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKFxuICBzZXR0aW5ncyxcbiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNhdmF0YXItZm9ybVwiKVxuKTtcbmF2YXRhckZvcm1WYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpOyAvLyBjYWxsIGVuYWJsZSB2YWxpZGF0aW9uXG5cbi8vID09PT09PT09PSAgUE9QVVAgQ0xBU1MgSU5TVEFOQ0VTID09PT09PT09PSAvL1xuXG4vLyBOZXcgUG9wdXAgRm9ybSBmb3IgYWRkaW5nIGEgY2FyZFxuY29uc3QgbmV3Q2FyZFBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0oXCIjYWRkLWNhcmQtbW9kYWxcIiwgKGZvcm1EYXRhKSA9PiB7XG4gIGNvbnN0IG5hbWUgPSBmb3JtRGF0YS50aXRsZTtcbiAgY29uc3QgbGluayA9IGZvcm1EYXRhLmxpbms7XG4gIGhhbmRsZU5ld0NhcmRTdWJtaXQobmFtZSwgbGluayk7XG59KTtcbm5ld0NhcmRQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xuXG4vLyBOZXcgUG9wdXAgRm9ybSB0byBlZGl0IHByb2ZpbGVcbmNvbnN0IGVkaXRQcm9maWxlUG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybShcbiAgXCIjcHJvZmlsZS1lZGl0LW1vZGFsXCIsXG4gIGhhbmRsZVByb2ZpbGVFZGl0U3VibWl0XG4pO1xuZWRpdFByb2ZpbGVQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xuXG4vLyBOZXcgUG9wdXAgd2l0aCBJbWFnZVxuY29uc3QgcG9wdXBXaXRoSW1hZ2UgPSBuZXcgUG9wdXBXaXRoSW1hZ2UoXCIjaW1hZ2UtbW9kYWxcIik7XG5wb3B1cFdpdGhJbWFnZS5zZXRFdmVudExpc3RlbmVycygpO1xuXG4vLyBuZXcgcG9wdXAgZm9yIGRlbGV0aW5nIGEgY2FyZFxuY29uc3QgZGVsZXRlQ2FyZFBvcHVwID0gbmV3IFBvcHVwV2l0aENvbmZpcm1hdGlvbihcbiAgXCIjZGVsZXRlLWNhcmQtbW9kYWxcIixcbiAgaGFuZGxlRGVsZXRlQ2FyZFxuKTtcbi8vIHNldCBldmVudCBsaXN0ZW5lcnMgZm9yIGRlbGV0ZSBjYXJkIHBvcHVwXG5kZWxldGVDYXJkUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxuLy8gbmV3IHBvcHVwIGZvciBjaGFuZ2luZyBhdmF0YXJcbmNvbnN0IGNoYW5nZUF2YXRhclBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0oXG4gIFwiI2F2YXRhci1tb2RhbFwiLFxuICBoYW5kbGVBdmF0YXJTdWJtaXRcbik7XG5jaGFuZ2VBdmF0YXJQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xuXG4vLyA9PT09PT09PT0gIFVTRVIgSU5GTyAgPT09PT09PT09IC8vXG5cbi8vIEluc3RhbmNlIG9mIFVzZXIgSW5mb1xuY29uc3QgdXNlckluZm8gPSBuZXcgVXNlckluZm8oXG4gIFwiLnByb2ZpbGVfX3RpdGxlXCIsXG4gIFwiLnByb2ZpbGVfX2Rlc2NyaXB0aW9uXCIsXG4gIFwiLnByb2ZpbGVfX2ltYWdlXCJcbik7XG5cbi8vID09PT09PT09PSAgQVBJcyAgPT09PT09PT09IC8vXG5cbi8vIEluc3RhbmNlIG9mIEFwaVxuY29uc3QgYXBpID0gbmV3IEFwaSh7XG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQtYXBpLmVuLnRyaXBsZXRlbi1zZXJ2aWNlcy5jb20vdjFcIixcbiAgaGVhZGVyczoge1xuICAgIGF1dGhvcml6YXRpb246IFwiZDkxODk2OWItNDdmYS00ZjcyLTgxMzgtNjFiZTZhYjU1ODQwXCIsXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gIH0sXG59KTtcblxuLy8gZmV0Y2ggYW5kIHJlbmRlciBpbml0aWFsIGNhcmRzXG5hcGlcbiAgLmdldEluaXRpYWxDYXJkcygpXG4gIC50aGVuKChyZXN1bHQpID0+IHtcbiAgICAvLyBJbnN0YW5jZSBvZiBTZWN0aW9uXG4gICAgbGV0IHNlY3Rpb24gPSBuZXcgU2VjdGlvbihcbiAgICAgIHtcbiAgICAgICAgaXRlbXM6IHJlc3VsdC5yZXZlcnNlKCksXG4gICAgICAgIHJlbmRlcmVyOiBjcmVhdGVDYXJkLFxuICAgICAgfSxcbiAgICAgIFwiI2NhcmRzX19saXN0XCJcbiAgICApO1xuICAgIHNlY3Rpb24ucmVuZGVySXRlbXMocmVzdWx0KTtcbiAgfSlcbiAgLmNhdGNoKChlcnIpID0+IHtcbiAgICBjb25zb2xlLmVycm9yKGVycik7IC8vIGxvZyB0aGUgZXJyb3IgdG8gdGhlIGNvbnNvbGVcbiAgfSk7XG5cbi8vIGZldGNoIGFuZCByZW5kZXIgdXNlciBpbmZvXG5hcGlcbiAgLmdldFVzZXJJbmZvKClcbiAgLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgIC8vIHVwZGF0ZSBVSSB0byByZWZsZWN0IHRoZSB1c2VyIGluZm8gZnJvbSB0aGUgZGJcbiAgICAvLyBjb25zb2xlLmxvZyhyZXN1bHQpO1xuICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHJlc3VsdC5uYW1lLCByZXN1bHQuYWJvdXQpO1xuICAgIHVzZXJJbmZvLnNldEF2YXRhcihyZXN1bHQuYXZhdGFyKTtcbiAgfSlcbiAgLmNhdGNoKChlcnIpID0+IHtcbiAgICBjb25zb2xlLmVycm9yKGVycik7IC8vIGxvZyB0aGUgZXJyb3IgdG8gdGhlIGNvbnNvbGVcbiAgfSk7XG5cbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuLy8gPT09PT09PT09ICBGVU5DVElPTlMgID09PT09PT09PSAvL1xuXG5mdW5jdGlvbiBjcmVhdGVDYXJkKGNhcmREYXRhKSB7XG4gIGNvbnN0IGNhcmQgPSBuZXcgQ2FyZChcbiAgICBjYXJkRGF0YSxcbiAgICBcIiNjYXJkLXRlbXBsYXRlXCIsXG4gICAgaGFuZGxlSW1hZ2VDbGljayxcbiAgICBoYW5kbGVEZWxldGVDYXJkLFxuICAgIGhhbmRsZUxpa2VDbGljayxcbiAgICBoYW5kbGVVbmxpa2VDbGlja1xuICApO1xuICByZXR1cm4gY2FyZC5nZXRWaWV3KCk7XG59XG5cbmZ1bmN0aW9uIHJlbmRlckNhcmQoY2FyZERhdGEpIHtcbiAgY29uc3QgY2FyZFZpZXcgPSBjcmVhdGVDYXJkKGNhcmREYXRhKTtcbiAgY29uc3Qgc2VjdGlvbiA9IG5ldyBTZWN0aW9uKHt9LCBcIiNjYXJkc19fbGlzdFwiKTtcbiAgc2VjdGlvbi5hZGRJdGVtKGNhcmRWaWV3KTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlSW1hZ2VDbGljayh7IG5hbWUsIGxpbmsgfSkge1xuICAvLyBvcGVuIHRoZSBwb3B1cCB3aXRoIHRoZSBpbWFnZVxuICBwb3B1cFdpdGhJbWFnZS5vcGVuKHsgbGluaywgbmFtZSB9KTtcbn1cblxuLy8gPT09PT09PT09ICBFVkVOVCBIQU5ETEVSUyAgPT09PT09PT09IC8vXG5cbi8vIEhhbmRsZXMgZWRpdCBmb3JtIHN1Ym1pdFxuZnVuY3Rpb24gaGFuZGxlUHJvZmlsZUVkaXRTdWJtaXQoeyB0aXRsZSwgZGVzY3JpcHRpb24gfSkge1xuICBhcGlcbiAgICAuZWRpdFByb2ZpbGVJbmZvKHtcbiAgICAgIG5hbWU6IHRpdGxlLFxuICAgICAgYWJvdXQ6IGRlc2NyaXB0aW9uLFxuICAgIH0pXG4gICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKGRhdGEubmFtZSwgZGF0YS5hYm91dCk7XG4gICAgICBlZGl0Rm9ybVZhbGlkYXRvci5kaXNhYmxlU3VibWl0QnV0dG9uKCk7XG4gICAgICBlZGl0UHJvZmlsZVBvcHVwLmNsb3NlKCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgIH0pO1xufVxuXG4vLyBoYW5kbGVzIG5ldyBjYXJkIHN1Ym1pc3Npb25cbmZ1bmN0aW9uIGhhbmRsZU5ld0NhcmRTdWJtaXQobmFtZSwgbGluaykge1xuICBhcGlcbiAgICAuYWRkTmV3Q2FyZCh7XG4gICAgICBuYW1lOiBuYW1lLFxuICAgICAgbGluazogbGluayxcbiAgICB9KVxuICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICByZW5kZXJDYXJkKGRhdGEpO1xuICAgICAgY2FyZEZvcm1WYWxpZGF0b3IuZGlzYWJsZVN1Ym1pdEJ1dHRvbigpO1xuICAgICAgbmV3Q2FyZFBvcHVwLmNsb3NlKCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgIH0pO1xufVxuXG4vLyBoYW5kbGVzIGRlbGV0aW5nIGNhcmRcbmZ1bmN0aW9uIGhhbmRsZURlbGV0ZUNhcmQoY2FyZCkge1xuICAvLyBvcGVuIHRoZSBkZWxldGUgY2FyZCBwb3B1cFxuICBkZWxldGVDYXJkUG9wdXAub3BlbigpO1xuICBkZWxldGVDYXJkUG9wdXAuc2V0U3VibWl0Q2FsbGJhY2soKCkgPT4ge1xuICAgIGFwaVxuICAgICAgLmRlbGV0ZUNhcmQoY2FyZC5nZXRJZCgpKVxuICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICBjYXJkLmRlbGV0ZUNhcmQoKTtcbiAgICAgICAgZGVsZXRlQ2FyZFBvcHVwLmNsb3NlKCk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgfSk7XG4gIH0pO1xufVxuXG4vLyBmdW5jdGlvbiB0byBoYW5kbGUgbGlrZSBidXR0b24gY2xpY2tcbmZ1bmN0aW9uIGhhbmRsZUxpa2VDbGljayhjYXJkKSB7XG4gIC8vIGNvbnN0IGNhcmRJZCA9IGNhcmQuZ2V0SWQoKTtcbiAgYXBpXG4gICAgLmxpa2VDYXJkKGNhcmQuX2lkKVxuICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICBjYXJkLl9oYW5kbGVMaWtlSWNvbigpO1xuICAgICAgY2FyZC5faXNMaWtlZCA9IHRydWU7XG4gICAgICBjb25zb2xlLmxvZyhcIkNhcmQgbGlrZWQ6XCIsIGRhdGEpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlVW5saWtlQ2xpY2soY2FyZCkge1xuICBhcGlcbiAgICAucmVtb3ZlTGlrZShjYXJkLl9pZClcbiAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgY2FyZC5faGFuZGxlTGlrZUljb24oKTtcbiAgICAgIGNhcmQuX2lzTGlrZWQgPSBmYWxzZTtcbiAgICAgIGNvbnNvbGUubG9nKFwiQ2FyZCBkaXNsaWtlZDpcIiwgZGF0YSk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICB9KTtcbn1cblxuLy8gaGFuZGxlcyBhdmF0YXIgZm9ybSBzdWJtaXQgd2l0aCBhcGlcbmZ1bmN0aW9uIGhhbmRsZUF2YXRhclN1Ym1pdCgpIHtcbiAgY29uc3QgYXZhdGFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNhdmF0YXItbGluay1pbnB1dFwiKS52YWx1ZTtcbiAgYXBpXG4gICAgLnVwZGF0ZUF2YXRhcih7XG4gICAgICBhdmF0YXI6IGF2YXRhcixcbiAgICB9KVxuICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICBwcm9maWxlQXZhdGFyLnNyYyA9IGRhdGEuYXZhdGFyO1xuICAgICAgYXZhdGFyRm9ybVZhbGlkYXRvci5kaXNhYmxlU3VibWl0QnV0dG9uKCk7XG4gICAgICBjaGFuZ2VBdmF0YXJQb3B1cC5jbG9zZSgpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICB9KTtcbn1cblxuLy8gPT09PT09PT09ICBFVkVOVCBMSVNURU5FUlMgID09PT09PT09PSAvL1xuXG5wcm9maWxlRWRpdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBjb25zdCB1c2VyRGF0YSA9IHVzZXJJbmZvLmdldFVzZXJJbmZvKCk7XG4gIHByb2ZpbGVUaXRsZUlucHV0LnZhbHVlID0gdXNlckRhdGEudGl0bGU7XG4gIHByb2ZpbGVEZXNjcmlwdGlvbklucHV0LnZhbHVlID0gdXNlckRhdGEuZGVzY3JpcHRpb247XG4gIGVkaXRGb3JtVmFsaWRhdG9yLnJlc2V0VmFsaWRhdGlvbigpO1xuICBlZGl0UHJvZmlsZVBvcHVwLm9wZW4oKTtcbn0pO1xuXG4vLyBMaXN0ZW5zIGZvciBhZGQgYnV0dG9uIGNsaWNrLCBmdW5jdGlvbnMgdG8gb3BlbiBuZXcgY2FyZCBmcm9tIG1vZGFsLlxucHJvZmlsZUFkZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBuZXdDYXJkUG9wdXAub3BlbigpO1xufSk7XG5cbi8vIExpc3RlbnMgZm9yIGF2YXRhciBjbGljaywgZnVuY3Rpb25zIHRvIG9wZW4gY2hhbmdlIGF2YXRhciBtb2RhbC5cbnByb2ZpbGVBdmF0YXJCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgY2hhbmdlQXZhdGFyUG9wdXAub3BlbigpO1xufSk7XG4iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcblxuY2xhc3MgUG9wdXBXaXRoSW1hZ2UgZXh0ZW5kcyBQb3B1cCB7XG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IpIHtcbiAgICBzdXBlcih7IHBvcHVwU2VsZWN0b3IgfSk7XG4gICAgLy8gY2xhc3MgZmllbGRzIGRlZmluZWRcbiAgICB0aGlzLl9wb3B1cENhcHRpb24gPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgIFwiLm1vZGFsX19wb3B1cC1jYXB0aW9uXCJcbiAgICApO1xuICAgIHRoaXMuX2ltYWdlRWxlbWVudCA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19pbWFnZVwiKTtcbiAgfVxuXG4gIG9wZW4oeyBsaW5rLCBuYW1lIH0pIHtcbiAgICB0aGlzLl9wb3B1cENhcHRpb24udGV4dENvbnRlbnQgPSBuYW1lO1xuICAgIHRoaXMuX2ltYWdlRWxlbWVudC5zcmMgPSBsaW5rO1xuICAgIHRoaXMuX2ltYWdlRWxlbWVudC5hbHQgPSBgSW1hZ2Ugb2YgJHtuYW1lfWA7XG5cbiAgICBzdXBlci5vcGVuKCk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgUG9wdXBXaXRoSW1hZ2U7XG4iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXBcIjtcblxuY2xhc3MgUG9wdXBXaXRoQ29uZmlybWF0aW9uIGV4dGVuZHMgUG9wdXAge1xuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yKSB7XG4gICAgc3VwZXIoeyBwb3B1cFNlbGVjdG9yIH0pO1xuICB9XG5cbiAgLy8gc2V0IGV2ZW50IGxpc3RlbmVyc1xuICBzZXRFdmVudExpc3RlbmVycygpIHtcbiAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpO1xuICAgIHRoaXMuX3BvcHVwRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgdGhpcy5faGFuZGxlU3VibWl0KCk7XG4gICAgfSk7XG4gIH1cblxuICAvLyBzZXQgc3VibWl0IGNhbGxiYWNrXG4gIHNldFN1Ym1pdENhbGxiYWNrKGFjdGlvbikge1xuICAgIC8vIHNldCBzdWJtaXQgaGFuZGxlclxuICAgIHRoaXMuX2hhbmRsZVN1Ym1pdCA9IGFjdGlvbjtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBQb3B1cFdpdGhDb25maXJtYXRpb247XG4iLCJleHBvcnQgY2xhc3MgVXNlckluZm8ge1xuICAvLyBwYXNzIGluIHNlbGVjdG9yJ3MgYXMgYXJndW1lbnRzXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByb2ZpbGVUaXRsZVNlbGVjdG9yLFxuICAgIHByb2ZpbGVEZXNjcmlwdGlvblNlbGVjdG9yLFxuICAgIHByb2ZpbGVBdmF0YXJTZWxlY3RvclxuICApIHtcbiAgICAvLyB1c2UgcXVlcnkgc2VsZWN0b3IgdG8gZ2V0IGVsZW1lbnRzIGFuZCBhc3NpZ24gdG8gdGhpc1xuICAgIHRoaXMuX3Byb2ZpbGVUaXRsZUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHByb2ZpbGVUaXRsZVNlbGVjdG9yKTtcbiAgICB0aGlzLl9wcm9maWxlRGVzY3JpcHRpb25FbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgIHByb2ZpbGVEZXNjcmlwdGlvblNlbGVjdG9yXG4gICAgKTtcbiAgICB0aGlzLl9wcm9maWxlQXZhdGFyRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IocHJvZmlsZUF2YXRhclNlbGVjdG9yKTtcbiAgfVxuXG4gIGdldFVzZXJJbmZvKCkge1xuICAgIC8vIHJldHVybiBvYmplY3QgY29udGFpbmluZyB0aGUgdGV4dCBjb250ZW50IG9mIHRoZSBwcm9maWxlIGVsZW1lbnRzXG4gICAgcmV0dXJuIHtcbiAgICAgIHRpdGxlOiB0aGlzLl9wcm9maWxlVGl0bGVFbGVtZW50LnRleHRDb250ZW50LFxuICAgICAgZGVzY3JpcHRpb246IHRoaXMuX3Byb2ZpbGVEZXNjcmlwdGlvbkVsZW1lbnQudGV4dENvbnRlbnQsXG4gICAgfTtcbiAgfVxuXG4gIC8vIHBhc3MgaW4gdGhlIHZhbHVlcyBmcm9tIHRoZSBmb3JtIHN1Ym1pc3Npb25cbiAgc2V0VXNlckluZm8odGl0bGUsIGRlc2NyaXB0aW9uKSB7XG4gICAgdGhpcy5fcHJvZmlsZVRpdGxlRWxlbWVudC50ZXh0Q29udGVudCA9IHRpdGxlO1xuICAgIHRoaXMuX3Byb2ZpbGVEZXNjcmlwdGlvbkVsZW1lbnQudGV4dENvbnRlbnQgPSBkZXNjcmlwdGlvbjtcbiAgICAvLyBzaW1pbGFybHkgZm9yIHRoZSBvdGhlciBlbGVtZW50XG4gIH1cblxuICBzZXRBdmF0YXIobGluaykge1xuICAgIC8vIHNldCB0aGUgXCJzcmNcIiBvZiB0aGUgYXZhdGFyIGVsZW1lbnRcbiAgICB0aGlzLl9wcm9maWxlQXZhdGFyRWxlbWVudC5zcmMgPSBsaW5rO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFVzZXJJbmZvO1xuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXBpIHtcbiAgY29uc3RydWN0b3Iob3B0aW9ucykge1xuICAgIHRoaXMuYmFzZVVybCA9IG9wdGlvbnMuYmFzZVVybDtcbiAgICB0aGlzLmhlYWRlcnMgPSBvcHRpb25zLmhlYWRlcnM7XG4gICAgLy8gdGhpcy5jb250ZW50VHlwZSA9IG9wdGlvbnMuY29udGVudFR5cGU7IC8vIFwiYXBwbGljYXRpb24vanNvblwiXG4gIH1cblxuICAvLyBmdW5jdGlvbiB0byBnZXQgdXNlciBpbmZvIGZyb20gdGhlIHNlcnZlclxuICBnZXRVc2VySW5mbygpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVycyxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG4gICAgICAvLyBpZiB0aGUgc2VydmVyIHJldHVybnMgYW4gZXJyb3IsIHJlamVjdCB0aGUgcHJvbWlzZVxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gbG9hZGluZyBjYXJkcyBmcm9tIHRoZSBzZXJ2ZXJcbiAgZ2V0SW5pdGlhbENhcmRzKCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLmJhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXJzLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH1cbiAgICAgIC8vIGlmIHRoZSBzZXJ2ZXIgcmV0dXJucyBhbiBlcnJvciwgcmVqZWN0IHRoZSBwcm9taXNlXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cblxuICAvLyBlZGl0aW5nIHRoZSBwcm9maWxlXG4gIGVkaXRQcm9maWxlSW5mbyh7IG5hbWUsIGFib3V0IH0pIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBuYW1lOiBuYW1lLFxuICAgICAgICBhYm91dDogYWJvdXQsXG4gICAgICB9KSxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG4gICAgICAvLyBpZiB0aGUgc2VydmVyIHJldHVybnMgYW4gZXJyb3IsIHJlamVjdCB0aGUgcHJvbWlzZVxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gYWRkaW5nIGEgbmV3IGNhcmRcbiAgYWRkTmV3Q2FyZCh7IG5hbWUsIGxpbmsgfSkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLmJhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgbmFtZTogbmFtZSxcbiAgICAgICAgbGluazogbGluayxcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH1cbiAgICAgIC8vIGlmIHRoZSBzZXJ2ZXIgcmV0dXJucyBhbiBlcnJvciwgcmVqZWN0IHRoZSBwcm9taXNlXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cblxuICAvLyBkZWxldGluZyBhIGNhcmRcbiAgZGVsZXRlQ2FyZChjYXJkSWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5iYXNlVXJsfS9jYXJkcy8ke2NhcmRJZH1gLCB7XG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLmhlYWRlcnMsXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoXCJDYXJkIGRlbGV0ZWRcIik7XG4gICAgICB9XG4gICAgICAvLyBpZiB0aGUgc2VydmVyIHJldHVybnMgYW4gZXJyb3IsIHJlamVjdCB0aGUgcHJvbWlzZVxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gbGlrZSBhIGNhcmRcbiAgbGlrZUNhcmQoY2FyZElkKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9L2xpa2VzYCwge1xuICAgICAgbWV0aG9kOiBcIlBVVFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXJzLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH1cbiAgICAgIC8vIGlmIHRoZSBzZXJ2ZXIgcmV0dXJucyBhbiBlcnJvciwgcmVqZWN0IHRoZSBwcm9taXNlXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cblxuICAvLyByZW1vdmUgYSBsaWtlXG4gIHJlbW92ZUxpa2UoY2FyZElkKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9L2xpa2VzYCwge1xuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXJzLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH1cbiAgICAgIC8vIGlmIHRoZSBzZXJ2ZXIgcmV0dXJucyBhbiBlcnJvciwgcmVqZWN0IHRoZSBwcm9taXNlXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cblxuICAvLyB1cGRhdGluZyB0aGUgcHJvZmlsZSBwaWN0dXJlXG4gIHVwZGF0ZUF2YXRhcih7IGF2YXRhciB9KSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLmhlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIGF2YXRhcjogYXZhdGFyLFxuICAgICAgfSksXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSB7XG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgfVxuICAgICAgLy8gaWYgdGhlIHNlcnZlciByZXR1cm5zIGFuIGVycm9yLCByZWplY3QgdGhlIHByb21pc2VcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIkNhcmQiLCJjb25zdHJ1Y3RvciIsIl9yZWYiLCJjYXJkU2VsZWN0b3IiLCJoYW5kbGVJbWFnZUNsaWNrIiwiX2hhbmRsZURlbGV0ZUNhcmQiLCJoYW5kbGVMaWtlQ2xpY2siLCJoYW5kbGVVbmxpa2VDbGljayIsIm5hbWUiLCJsaW5rIiwiX2lkIiwiaXNMaWtlZCIsInRoaXMiLCJfbmFtZSIsIl9saW5rIiwiX2lzTGlrZWQiLCJfY2FyZFNlbGVjdG9yIiwiX2hhbmRsZUltYWdlQ2xpY2siLCJfaGFuZGxlTGlrZUNsaWNrIiwiX2hhbmRsZVVubGlrZUNsaWNrIiwiZ2V0SWQiLCJnZXRJc0xpa2VkIiwiX2dldEVsZW1lbnQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiZ2V0VmlldyIsIl9jYXJkRWxlbWVudCIsIl9saWtlQnV0dG9uIiwiX2RlbGV0ZUJ1dHRvbiIsIl9jYXJkSW1hZ2VFbCIsIl9jYXJkVGl0bGVFbCIsInNyYyIsImFsdCIsInRleHRDb250ZW50IiwiX3NldEV2ZW50TGlzdGVuZXJzIiwiX3NldExpa2VTdGF0ZSIsImNsYXNzTGlzdCIsImFkZCIsInJlbW92ZSIsIl9oYW5kbGVMaWtlSWNvbiIsInRvZ2dsZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJkZWxldGVDYXJkIiwiRm9ybVZhbGlkYXRvciIsInNldHRpbmdzIiwiZm9ybUVsZW1lbnQiLCJfZm9ybUVsZW1lbnQiLCJfaW5wdXRTZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJfc3VibWl0QnV0dG9uU2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsIl9pbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsIl9pbnB1dEVycm9yQ2xhc3MiLCJpbnB1dEVycm9yQ2xhc3MiLCJfZXJyb3JDbGFzcyIsImVycm9yQ2xhc3MiLCJfaW5wdXRFbGVtZW50cyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJfc3VibWl0QnV0dG9uIiwiX3Nob3dJbnB1dEVycm9yIiwiaW5wdXRFbGVtZW50IiwiZXJyb3JNZXNzYWdlRWxlbWVudCIsImlkIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJfaGlkZUlucHV0RXJyb3IiLCJfY2hlY2tJbnB1dFZhbGlkaXR5IiwidmFsaWRpdHkiLCJ2YWxpZCIsIl9oYXNJbnZhbGlkSW5wdXQiLCJBcnJheSIsImZyb20iLCJzb21lIiwiX2Rpc2FibGVCdXR0b24iLCJkaXNhYmxlZCIsIl9lbmFibGVCdXR0b24iLCJfdG9nZ2xlQnV0dG9uU3RhdGUiLCJmb3JFYWNoIiwicmVzZXRWYWxpZGF0aW9uIiwiZGlzYWJsZVN1Ym1pdEJ1dHRvbiIsImVuYWJsZVZhbGlkYXRpb24iLCJldnQiLCJwcmV2ZW50RGVmYXVsdCIsIlNlY3Rpb24iLCJjb250YWluZXJTZWxlY3RvciIsIml0ZW1zIiwicmVuZGVyZXIiLCJfaXRlbXMiLCJfcmVuZGVyZXIiLCJfY29udGFpbmVyIiwicmVuZGVySXRlbXMiLCJpdGVtIiwiZWxlbWVudCIsImFkZEl0ZW0iLCJwcmVwZW5kIiwiUG9wdXAiLCJwb3B1cFNlbGVjdG9yIiwiX3BvcHVwRWxlbWVudCIsIl9oYW5kbGVLZXlEb3duIiwiYmluZCIsIm9wZW4iLCJjbG9zZSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJrZXkiLCJzZXRFdmVudExpc3RlbmVycyIsImNsb3NlQnV0dG9uIiwidGFyZ2V0IiwiY29udGFpbnMiLCJoYW5kbGVGb3JtU3VibWl0Iiwic3VwZXIiLCJfcG9wdXBGb3JtIiwiX2hhbmRsZUZvcm1TdWJtaXQiLCJfaW5wdXRGaWVsZHMiLCJfZm9ybVN1Ym1pdEhhbmRsZXIiLCJfZ2V0SW5wdXRWYWx1ZXMiLCJpbnB1dFZhbHVlcyIsImlucHV0IiwidmFsdWUiLCJyZXNldCIsImZvcm1TZWxlY3RvciIsInByb2ZpbGVBZGRCdXR0b24iLCJwcm9maWxlRWRpdEJ1dHRvbiIsInByb2ZpbGVBdmF0YXIiLCJwcm9maWxlQXZhdGFyQnV0dG9uIiwicHJvZmlsZVRpdGxlSW5wdXQiLCJwcm9maWxlRGVzY3JpcHRpb25JbnB1dCIsImZvcm1zIiwiZWRpdEZvcm1WYWxpZGF0b3IiLCJjYXJkRm9ybVZhbGlkYXRvciIsImF2YXRhckZvcm1WYWxpZGF0b3IiLCJuZXdDYXJkUG9wdXAiLCJQb3B1cFdpdGhGb3JtIiwiZm9ybURhdGEiLCJ0aXRsZSIsImFwaSIsImFkZE5ld0NhcmQiLCJ0aGVuIiwiZGF0YSIsImNhcmREYXRhIiwiY2FyZFZpZXciLCJjcmVhdGVDYXJkIiwicmVuZGVyQ2FyZCIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwiZWRpdFByb2ZpbGVQb3B1cCIsIl9yZWYyIiwiZGVzY3JpcHRpb24iLCJlZGl0UHJvZmlsZUluZm8iLCJhYm91dCIsInVzZXJJbmZvIiwic2V0VXNlckluZm8iLCJwb3B1cFdpdGhJbWFnZSIsIl9wb3B1cENhcHRpb24iLCJfaW1hZ2VFbGVtZW50IiwiZGVsZXRlQ2FyZFBvcHVwIiwiX2hhbmRsZVN1Ym1pdCIsInNldFN1Ym1pdENhbGxiYWNrIiwiYWN0aW9uIiwiaGFuZGxlRGVsZXRlQ2FyZCIsImNoYW5nZUF2YXRhclBvcHVwIiwiYXZhdGFyIiwidXBkYXRlQXZhdGFyIiwicHJvZmlsZVRpdGxlU2VsZWN0b3IiLCJwcm9maWxlRGVzY3JpcHRpb25TZWxlY3RvciIsInByb2ZpbGVBdmF0YXJTZWxlY3RvciIsIl9wcm9maWxlVGl0bGVFbGVtZW50IiwiX3Byb2ZpbGVEZXNjcmlwdGlvbkVsZW1lbnQiLCJfcHJvZmlsZUF2YXRhckVsZW1lbnQiLCJnZXRVc2VySW5mbyIsInNldEF2YXRhciIsIm9wdGlvbnMiLCJiYXNlVXJsIiwiaGVhZGVycyIsImZldGNoIiwicmVzIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInN0YXR1cyIsImdldEluaXRpYWxDYXJkcyIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiY2FyZElkIiwicmVzb2x2ZSIsImxpa2VDYXJkIiwicmVtb3ZlTGlrZSIsIl9yZWYzIiwiYXV0aG9yaXphdGlvbiIsImNhcmQiLCJsb2ciLCJyZXN1bHQiLCJyZXZlcnNlIiwidXNlckRhdGEiXSwic291cmNlUm9vdCI6IiJ9